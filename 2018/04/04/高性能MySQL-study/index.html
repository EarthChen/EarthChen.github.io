<!DOCTYPE html>
<html >
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="EarthChen" />



<meta name="description" content="高性能MySQL读书笔记。。。">
<meta name="keywords" content="MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="高性能MySQL学习笔记">
<meta property="og:url" content="http://earthchen.cn/2018/04/04/高性能MySQL-study/index.html">
<meta property="og:site_name" content="EarthChen&#39;s Blog">
<meta property="og:description" content="高性能MySQL读书笔记。。。">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-07-21T08:24:50.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="高性能MySQL学习笔记">
<meta name="twitter:description" content="高性能MySQL读书笔记。。。">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="EarthChen&#39;s Blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/black/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>高性能MySQL学习笔记 | EarthChen&#39;s Blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>





    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?838a8860a1d9fc43bc091f40a8ab515d";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="http://objects.earthchen.cn/%E5%A4%B4%E5%83%8F.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">EarthChen</a></h1>
        </hgroup>

        
        <p class="header-subtitle">多学一点知识，少写一行代码</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="true" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="http://mail.163.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/EarthChen" title="GitHub"></a>
                            
                                <a class="fa 知乎" href="https://www.zhihu.com/people/diamand-76/activities" title="知乎"></a>
                            
                                <a class="fa 简书" href="http://www.jianshu.com/u/85a919706c15" title="简书"></a>
                            
                                <a class="fa QQ" href="http://user.qzone.qq.com/1791538609" title="QQ"></a>
                            
                                <a class="fa 微信" href="https://wx.qq.com/" title="微信"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AJAX/">AJAX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Celery/">Celery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/">Django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearch/">Elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gogs/">Gogs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hbase/">Hbase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LeetCode/">LeetCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/">Node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Regular-Expression/">Regular Expression</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-boot/">Spring boot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/解决方案/">解决方案</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/资源/">资源</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.baidu.com/">Baidu</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://www.google.com/">Google</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://fanyi.youdao.com/">有道翻译</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于技术 学习中的程序猿</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">EarthChen</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="http://objects.earthchen.cn/%E5%A4%B4%E5%83%8F.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">EarthChen</a></h1>
            </hgroup>
            
            <p class="header-subtitle">多学一点知识，少写一行代码</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="http://mail.163.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/EarthChen" title="GitHub"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/diamand-76/activities" title="知乎"></a>
                            
                                <a class="fa 简书" target="_blank" href="http://www.jianshu.com/u/85a919706c15" title="简书"></a>
                            
                                <a class="fa QQ" target="_blank" href="http://user.qzone.qq.com/1791538609" title="QQ"></a>
                            
                                <a class="fa 微信" target="_blank" href="https://wx.qq.com/" title="微信"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-高性能MySQL-study" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/04/04/高性能MySQL-study/" class="article-date">
      <time datetime="2018-04-04T08:30:00.000Z" itemprop="datePublished">2018-04-04</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      高性能MySQL学习笔记
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/学习笔记/">学习笔记</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>高性能MySQL读书笔记。。。</p>
<a id="more"></a>
<h2 id="MySQL架构"><a href="#MySQL架构" class="headerlink" title="MySQL架构"></a>MySQL架构</h2><h3 id="并发控制"><a href="#并发控制" class="headerlink" title="并发控制"></a>并发控制</h3><h4 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h4><p>在处理并发读或者写时，通过实现一个由两种类型的锁组成的锁系统来解决问题。</p>
<ol>
<li><p>两种锁的类型为:</p>
<ul>
<li>共享锁(读锁):是共享的，或者说是互补阻塞的。多个客户在同意时刻可以同事读取同一个资源。</li>
<li>排他锁(写锁):排他的，一个写锁会阻塞其他写锁和读锁。</li>
</ul>
</li>
<li><p>锁粒度</p>
</li>
</ol>
<p>2.1 表锁<br>是最基本的锁策略，开销最小的策略。</p>
<ul>
<li>当一个用户获得写锁时，会阻塞其他用户对该表进行的所有读写操作。</li>
<li>读锁相互不阻塞。</li>
</ul>
<p>2.2 行级锁<br>可以最大成都的支持并发处理(最大的锁开销).</p>
<h3 id="事物"><a href="#事物" class="headerlink" title="事物"></a>事物</h3><p>事物就是一组原子性的sql，或者说是一个独立的工作单元。</p>
<blockquote>
<p>ACID的概念:</p>
<ul>
<li>原子性</li>
<li>一致性</li>
<li>隔离性</li>
<li>持久性</li>
</ul>
</blockquote>
<h4 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h4><p>在sql标准中定义了四种隔离级别</p>
<ul>
<li><p>READ UNCOMMITTED （未提交读）</p>
<p>  事物中的修改，即使没有提交，对其他事物也都是可见的。事物可以读取未提交的数据，成为脏读。</p>
</li>
<li><p>READ COMMITED（提交读）</p>
<p>  大多数数据库系统的默认隔离级别都是提交读(但MySQL不是)。该隔离级别定义为:一个事物开始时，只能看见已经提交的事务所做的修改。这个级别有时候也叫做不可重复读。</p>
</li>
<li><p>REPEATABLE READ (可重复读)</p>
<p>  该级别保证在同一个事务中多次读取同样的记录结果是一直的。该级别不能解决<strong>幻读</strong>的问题。幻读就是在某个事务读取某个范围内的记录时，另外一个事务又在该范围内插入了新的记录，当之前的事务再次读取该范围的记录时，就会产生幻行。</p>
</li>
<li><p>SERIALIZABLE （可串行化）</p>
<p>  是最高的隔离级别，通过强制事务穿行执行，避免了前面所说的幻读的问题。简单来说，该级别会在读取的每一行的数据上都加锁，所以可能导致大量的超时和锁征用的问题。</p>
</li>
</ul>
<h3 id="MySQL的存储引擎"><a href="#MySQL的存储引擎" class="headerlink" title="MySQL的存储引擎"></a>MySQL的存储引擎</h3><p>默认引擎为InnoDB,一般没有特殊需求直接使用即可。</p>
<h2 id="Schema与数据类型优化"><a href="#Schema与数据类型优化" class="headerlink" title="Schema与数据类型优化"></a>Schema与数据类型优化</h2><h3 id="选择优化的数据类型"><a href="#选择优化的数据类型" class="headerlink" title="选择优化的数据类型"></a>选择优化的数据类型</h3><ol>
<li>更小的通常更好</li>
<li>简单就好</li>
<li>尽量避免null</li>
</ol>
<h3 id="MySQL-schema设计中的陷阱"><a href="#MySQL-schema设计中的陷阱" class="headerlink" title="MySQL schema设计中的陷阱"></a>MySQL schema设计中的陷阱</h3><ol>
<li>太多的列</li>
<li>太多的关联</li>
<li>全能的枚举</li>
<li>变相的枚举</li>
<li>非此发明的null</li>
</ol>
<h3 id="范式和反范式"><a href="#范式和反范式" class="headerlink" title="范式和反范式"></a>范式和反范式</h3><h4 id="范式的优缺点"><a href="#范式的优缺点" class="headerlink" title="范式的优缺点"></a>范式的优缺点</h4><blockquote>
<p>优点：</p>
<ul>
<li>范式的更新操作通常更快</li>
<li>有较少的重复数据，在修改时，只要修改更少的数据</li>
<li>表通常更小，更好的放在内存中，执行操作会更快</li>
<li>检索列表数据时更少需要DISTINCT或者GROUP BY语句</li>
</ul>
<p>缺点</p>
<ul>
<li>通常需要关联，多表关联的代价昂贵，也可能使得一些索引策略无效</li>
</ul>
</blockquote>
<h4 id="反范式的优缺点"><a href="#反范式的优缺点" class="headerlink" title="反范式的优缺点"></a>反范式的优缺点</h4><blockquote>
<p>优点：</p>
<ul>
<li>反范式很好的避免关联</li>
<li>能使用更有效的索引策略</li>
</ul>
<p>缺点</p>
<ul>
<li>造成较多的数据冗余</li>
</ul>
</blockquote>
<h4 id="混用范式和反范式"><a href="#混用范式和反范式" class="headerlink" title="混用范式和反范式"></a>混用范式和反范式</h4><p>完全的范式和反范式是不存在的，在实际操作中建议混用这两种策略，可能使用部分范式化的schema、缓存表、以及其他技巧。</p>
<h3 id="缓存表和汇总表"><a href="#缓存表和汇总表" class="headerlink" title="缓存表和汇总表"></a>缓存表和汇总表</h3><ol>
<li><p>用缓存表表示存储那些可以比较简单的从schema其他表获取（但是每次获取的数据比较慢）数据的表（逻辑上的沉余的数据）</p>
</li>
<li><p>用汇总表表示使用GROUP BY语句聚合数据的表（数据不是路逻辑上沉余的）</p>
</li>
</ol>
<h4 id="物化视图"><a href="#物化视图" class="headerlink" title="物化视图"></a>物化视图</h4><p>实际上是预计计算并且存储在磁盘上的表，可以通过各种各样的策略刷新和更新</p>
<h4 id="计数器表"><a href="#计数器表" class="headerlink" title="计数器表"></a>计数器表</h4><p>如果应用在表中保存计算器，则在更新计数器时可能碰到并发问题，创建一个独立的表存储计数器通常是个好主意，这样可以使计数器表小且快，使用独立的表可以帮助避免查询缓存失效。</p>
<h3 id="加快ALTER-TABLE操作的数据"><a href="#加快ALTER-TABLE操作的数据" class="headerlink" title="加快ALTER TABLE操作的数据"></a>加快ALTER TABLE操作的数据</h3><p>myql执行大部分修改表结构的操作方法是用一个新的结构创建一个空表，从旧表查询中所有数据插入新表，然后删除旧表</p>
<ol>
<li>一般来说，ALTER TABLE操作将导致myql服务中断，对常见的场景，能使用的技巧只有两种：<ul>
<li>先在一台不提供服务的机器上执行ALTER TABLE,然后和提供服务的主库进行切换</li>
<li>影子拷贝，意思是要用要求的表结构创建一张和源表无关的新表，然后通过重命名和删表操作交换两张表</li>
</ul>
</li>
</ol>
<p>不是所有的ALTER TABLE操作都会引起表重建，有两种方式：</p>
<h4 id="只修改-frm文件"><a href="#只修改-frm文件" class="headerlink" title="只修改.frm文件"></a>只修改.frm文件</h4><h4 id="快速创建myisam索引"><a href="#快速创建myisam索引" class="headerlink" title="快速创建myisam索引"></a>快速创建myisam索引</h4><h2 id="创建高性能的索引"><a href="#创建高性能的索引" class="headerlink" title="创建高性能的索引"></a>创建高性能的索引</h2><h3 id="索引基础"><a href="#索引基础" class="headerlink" title="索引基础"></a>索引基础</h3><h4 id="索引基础-1"><a href="#索引基础-1" class="headerlink" title="索引基础"></a>索引基础</h4><h5 id="B-Tree索引"><a href="#B-Tree索引" class="headerlink" title="B-Tree索引"></a>B-Tree索引</h5><p>如果没有特别说明，一般说的都是B-Tree索引，它使用B-Tree数据结构来存储数据。</p>
<ol>
<li><p>该索引对如下类型的查询有效：</p>
<ul>
<li>全值匹配(和索引中所有列进行匹配)</li>
<li>匹配最左前缀(只使用索引的第一列)</li>
<li>匹配范围值</li>
<li>匹配列前缀(匹配某一列的值的开头部分)</li>
<li>精确匹配某一列并范围匹配另外一列</li>
<li>只访问索引的查询(只需要访问索引，无需访问数据行)</li>
</ul>
</li>
<li><p>该索引的一些限制</p>
<ul>
<li>如果不是按照索引的最左列开始查找，则无法使用索引</li>
<li>不能跳过索引中的列</li>
<li>如果查询中有某个列的范围查询，则右边的所有列都无法使用索引优化查找</li>
</ul>
</li>
</ol>
<h5 id="哈希索引"><a href="#哈希索引" class="headerlink" title="哈希索引"></a>哈希索引</h5><p>基于哈希表实现，只有精确匹配索引所有列才有效。<br>在mysql中只有<strong>Memory</strong>引擎显示支持哈希索引</p>
<ol>
<li>哈希索引的限制<ul>
<li>只包含哈希值和行指针,而不包含字段值</li>
<li>不是按照索引值的顺序存储的，无法用于排序</li>
<li>不支持部分索引列匹配查找</li>
<li>只支持等值比较查询</li>
<li>访问哈希索引的数据非常快，除非有很多哈希冲突</li>
<li>如果冲突多，一些索引维护操作的代价会很高</li>
</ul>
</li>
</ol>
<h5 id="空间数据索引"><a href="#空间数据索引" class="headerlink" title="空间数据索引"></a>空间数据索引</h5><p>MyISAM表支持空间索引，可以用作地理数据存储，和b-tree索引不同，这类索引无须前缀查询，空间索引会从所有维度来所有数据。</p>
<h5 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h5><p>查找的是文本中的关键词，而不是直接比较索引中的值</p>
<h3 id="索引的优点"><a href="#索引的优点" class="headerlink" title="索引的优点"></a>索引的优点</h3><p>索引可以让服务器快速定位到表的指定位置，但这不是索引的唯一作用。</p>
<blockquote>
<p>索引的三个优点</p>
<ul>
<li>大大减少服务器需要扫描的数据量</li>
<li>帮助服务器避免排序和临时表</li>
<li>将随机io变为顺序io</li>
</ul>
</blockquote>
<h3 id="高性能的索引策略"><a href="#高性能的索引策略" class="headerlink" title="高性能的索引策略"></a>高性能的索引策略</h3><h4 id="独立的列"><a href="#独立的列" class="headerlink" title="独立的列"></a>独立的列</h4><p>如果查询中的列不是独立的，则mysql就不会使用索引</p>
<h4 id="前缀索引和索引选择性"><a href="#前缀索引和索引选择性" class="headerlink" title="前缀索引和索引选择性"></a>前缀索引和索引选择性</h4><ol>
<li><p>索引前缀：有时候索引很长的字符列，这会让索引变的大且慢。解决这个问题有两种方案。</p>
<ul>
<li>使用哈希索引</li>
<li>通常可以索引开始的部分字符，这样可以大大减少索引空间，从而提高索引效率</li>
</ul>
</li>
<li><p>索引选择性：不重复的索引值(也称之为基数)和数据表的记录总数的比值，索引的选择性越高则查询效率越高</p>
</li>
</ol>
<h4 id="多列索引"><a href="#多列索引" class="headerlink" title="多列索引"></a>多列索引</h4><p>一个常见的错误就是，为每个列创建独立的索引</p>
<p>在多个列上建立索引大部分情况下并不能提高mysql的查询性能，mysql5.0之后的版本引入了一种“索引合并”的策略，一定程度上可以使用表上的多个单列索引来定位指定的行。</p>
<p>索引合并有时候是一种优化的结构，但实际上更多时候说明了表上的索引建的很糟糕：</p>
<ul>
<li>当出现服务器对多个索引做香蕉操作时，（通常有多个and条件），通常意味着需要一个包含所有相关列的多列索引，而不是多个独立的单列索引。</li>
<li>当服务器需要对多个索引做联合操作时(通常有多个or条件)，通常需要耗费大量cou和和内存上在算法的的缓存、排序和合并操作上。</li>
<li>优化器不会吧这些计算到“查询成本”中，优化器只关心随机页面读取。</li>
</ul>
<h4 id="选择合适的索引列顺序"><a href="#选择合适的索引列顺序" class="headerlink" title="选择合适的索引列顺序"></a>选择合适的索引列顺序</h4><p>正确的顺序依赖于使用该索引的查询，并且需要同事考虑如何更好的满足排序和分组的需要。</p>
<p>在一个多列的B-Tree索引中，索引列的顺序意味着索引首先按照从左到右进行排序，所以索引可以按照升序或者降序进行扫描，以满足精确符合列顺序的ORDER BY、GROUP BY和DISTINCT等子句的查询需求。</p>
<p>当不考虑排序和分组时，将选择性最高的列防在前面通常是很好的。然而性能不只是依赖于所有索引列的选择性，也和查询条件的具体值有关，也就是和值的分布有关。</p>
<h4 id="聚簇索引"><a href="#聚簇索引" class="headerlink" title="聚簇索引"></a>聚簇索引</h4><p>聚簇索引并不是一种单独的索引类型，而是一种数据存储方式，InnoDB的聚簇索引实际上在同一个结构中保存了B-Tree索引和数据行。</p>
<p>当表有聚簇索引时，数据行实际上存放在索引的叶子页中。InnoDB将通过主键聚集数据，如果没有定义主键，会选择一个唯一的非空索引来替代，如果没有这样的索引，会隐式定义一个主键来作为聚簇索引。</p>
<blockquote>
<p>优点:</p>
<ul>
<li>可以把相关数据保存在一起</li>
<li>数据访问更快</li>
<li>使用覆盖索引扫描的查询可以直接使用页节点中的主键值</li>
</ul>
<p>缺点:</p>
<ul>
<li>最大限度的提高了io密集型应用的性能，如果数据全部放在内存中，则访问的顺序就不重要了</li>
<li>插入速度严重依赖于插入顺序</li>
<li>更新聚簇索引列的代价很高</li>
<li>居于聚簇索引的表在插入新航，或者主键呗更新导致需要移动行的时候，可能面临”页分裂”的问题</li>
<li>可能导致全表扫描变慢，尤其行比较稀疏，或者由于页分裂导致数据存储不连续</li>
<li>二级索可能比想象的更大，因为二级索引的叶子节点包含了引用行的主键列。</li>
<li>二级索引访问需要两次索引查找，而不是一次</li>
</ul>
</blockquote>
<h5 id="InnoDB-MyISAM的数据分布对比"><a href="#InnoDB-MyISAM的数据分布对比" class="headerlink" title="InnoDB MyISAM的数据分布对比"></a>InnoDB MyISAM的数据分布对比</h5><ol>
<li><p>MyISAM的数据分组非常简单，按照数据插入的顺序存储在磁盘上。</p>
</li>
<li><p>InnoDB的数据分布使用非常不同的方式存储同样的数据，聚簇索引“就是”表，不需要独立的行存储</p>
</li>
<li><p>使用InnoDB时应该尽可能的按主键顺序插入数据，并且尽可能使用单调增加的聚簇键的值来插入新行</p>
</li>
</ol>
<h4 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h4><p>如果一个索引包含(或者说覆盖)所有需要查询的字段的值，我们就称之为”覆盖索引”</p>
<p>如果查询只需要扫描索引而无须回表，能带来许多好处</p>
<ul>
<li>索引条目通常远小鱼数据行的大小，所以如果只需要读取索引，那mysql就会极大的减少数据访问量</li>
<li>因为索引是按照列值顺序存储的，所以对于io密集型的范围查询会比随机从磁盘读取每一行数据的io要少的多</li>
<li>一些存储引擎（如MyISAM）在内存中只缓存索引数据，数据则依赖操作系统来缓存，因此访问数据需要一次系统调用</li>
<li>由于InnoDB的聚簇索引，覆盖索引对InnoDB表特别有用</li>
</ul>
<h4 id="使用索引扫描来做排序"><a href="#使用索引扫描来做排序" class="headerlink" title="使用索引扫描来做排序"></a>使用索引扫描来做排序</h4><p>MySQL有两种方式可以生成有序的结果，通过排序操作，或者按照索引顺序扫描；如果EXPLAIN出来的type列的值为“index”，则说明使用了索引扫描来做排序</p>
<p>MySQL可以使用同一个索引既满足排序又用于查找行，所以，如果可能，设计索引时应该尽可能的满足这两种任务</p>
<p>只有当索引列顺序和ORDER BY子句的顺序完全一致，并且所有列的排序方向都一样时，才能使用索引来对结构做排序。如果需要关联多表，则当只有ORDER BY子句引用的字段全部为第一个表时，才能使用。</p>
<h4 id="压缩-前缀压缩-索引"><a href="#压缩-前缀压缩-索引" class="headerlink" title="压缩(前缀压缩)索引"></a>压缩(前缀压缩)索引</h4><p>MyISAM使用前缀压缩来减少索引的大小，从而让更多的索引可以防到内存中，在某些情况下可以极大提高性能。</p>
<h2 id="查询性能优化"><a href="#查询性能优化" class="headerlink" title="查询性能优化"></a>查询性能优化</h2><h3 id="慢查询基础：优化数据访问"><a href="#慢查询基础：优化数据访问" class="headerlink" title="慢查询基础：优化数据访问"></a>慢查询基础：优化数据访问</h3><p>有效的分析方法:</p>
<ul>
<li>确认应用是否存在检索大量超过需要的数据</li>
<li>确认服务器是否存在大量超过需要的数据行</li>
</ul>
<h4 id="是否向数据可请求了不需要的数据"><a href="#是否向数据可请求了不需要的数据" class="headerlink" title="是否向数据可请求了不需要的数据"></a>是否向数据可请求了不需要的数据</h4><ol>
<li>查询不需要的记录</li>
<li>多表关联时返回全部列</li>
<li>总是取出全部列</li>
<li>重复查询相同的数据</li>
</ol>
<h4 id="MySQL是否扫描额外的记录"><a href="#MySQL是否扫描额外的记录" class="headerlink" title="MySQL是否扫描额外的记录"></a>MySQL是否扫描额外的记录</h4><p>在确定查询只返回需要的数据后，接下来应该看看为了返回结果是否扫描了过多的数据</p>
<p>对于MySQL，简单的衡量查询开销的指标如下：</p>
<ul>
<li>响应时间</li>
<li>扫描的行数</li>
<li>返回的行数</li>
</ul>
<h5 id="响应时间"><a href="#响应时间" class="headerlink" title="响应时间"></a>响应时间</h5><p>响应时间=服务时间+排队时间</p>
<h5 id="扫描的行数和返回的行数"><a href="#扫描的行数和返回的行数" class="headerlink" title="扫描的行数和返回的行数"></a>扫描的行数和返回的行数</h5><p>理想情况下扫描的行数和返回的行数应该时相同的，但实际上基本不可能。扫描的行数对返回的行数的比率通常很小，一般在1:1和10:1之间。</p>
<h5 id="扫描的行数和访问类型"><a href="#扫描的行数和访问类型" class="headerlink" title="扫描的行数和访问类型"></a>扫描的行数和访问类型</h5><p>在评估查询开销的时候，需要考虑一下从表中找到某一行的数据的成本。</p>
<p>在EXPLAIN语句中的type列反应了访问类型，如果查询没有办法找到合适的访问类型，那么最好的解决办法通常就是增加一个合适的索引</p>
<p>一般MySQL能够使用如下方式应用where条件，从好到坏依次为：</p>
<ul>
<li>在索引中使用where条件来过滤不匹配的记录</li>
<li>使用索引覆盖扫描来返回记录，直接从索引中过滤不需要的记录并返回命中的结果。</li>
<li>从数据表中返回数据，然后过滤不满足条件的记录</li>
</ul>
<h3 id="重构查询方式"><a href="#重构查询方式" class="headerlink" title="重构查询方式"></a>重构查询方式</h3><p>在优化有问题的查询时，目标应该是找到一个更优的方式获得实际需要的结果，而不是一定总是需要从MySQL获取一样的结果集。</p>
<h4 id="一个复杂查询还是多个简单查询"><a href="#一个复杂查询还是多个简单查询" class="headerlink" title="一个复杂查询还是多个简单查询"></a>一个复杂查询还是多个简单查询</h4><p>设计查询的时候一个需要考虑的问题，是否需要将一个复杂的查询分成多个简单的查询。</p>
<p>在MySQL从设计上让连接和断开都很轻量，在返回一个小的查询结果方面很高效。</p>
<p>在其他条件都相同的时候，使用尽可能少的查询当然时好的，但是有时候，将一个大查询分解为多个小查询时很有必要的。在设计应用时，如果也过查询能够胜任时还写成多个独立的查询时不明智的。</p>
<h4 id="切分查询"><a href="#切分查询" class="headerlink" title="切分查询"></a>切分查询</h4><p>有时候我们需要对大查询分而治之，将大查询切分为小查询，每个查询功能完全一样，只完成一小部分，每次只返回一小部分查询结果</p>
<p>删除旧数据就是一个很好的例子，定期清除大量数据时如果用一个大的语句一次性完成的话，则可能需要一次锁住很多数据，占满整个失误日志，耗尽系统资源，阻塞很多小的但是重要的查询。</p>
<h4 id="分解关联查询"><a href="#分解关联查询" class="headerlink" title="分解关联查询"></a>分解关联查询</h4><p>对关联查询进行分解。简单的，可以对每一个表进行一次单表查询，然后将结果在应用程序中进行关联。</p>
<p> 通过分解关联查询的方式有如下的好处：</p>
<ul>
<li>让缓存的效率更高</li>
<li>将查询分解后，执行单个查询可以减少锁的竞争</li>
<li>查询本身效率也可能会有所提升</li>
<li>可以减少沉余记录的查询</li>
<li>相当于在应用中实现了哈希关联，而不是使用MySQL的嵌套循环关联</li>
</ul>
<h3 id="优化特定类型的查询"><a href="#优化特定类型的查询" class="headerlink" title="优化特定类型的查询"></a>优化特定类型的查询</h3><h4 id="优化count-查询"><a href="#优化count-查询" class="headerlink" title="优化count()查询"></a>优化count()查询</h4><p>有两种不同的作用:</p>
<ul>
<li>统计某个列的数量</li>
<li>统计行数</li>
</ul>
<h5 id="简单的优化"><a href="#简单的优化" class="headerlink" title="简单的优化"></a>简单的优化</h5><p>count(*)全表非常快，可以来加速一些特定条件的count查询</p>
<p>比如查询所有id大于5的城市<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> city <span class="keyword">where</span> <span class="keyword">id</span> &gt;<span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<p>通过反转可以将扫描行数减少到5行之内<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">form</span> city) - <span class="keyword">count</span>(*) <span class="keyword">from</span> city <span class="keyword">where</span> <span class="keyword">id</span> &lt;=<span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<h5 id="使用近似值"><a href="#使用近似值" class="headerlink" title="使用近似值"></a>使用近似值</h5><p>有些业务场景并不要求完全精确count值，此时可以用近似值来代替，EXPLAIN出来的优化器估算的行数就是一个不粗的近似值，执行explain并不需要真正的去执行查询</p>
<h5 id="更复杂的优化"><a href="#更复杂的优化" class="headerlink" title="更复杂的优化"></a>更复杂的优化</h5><p>在mysql层面还能做的就只有覆盖索引扫描，如果还不够，就需要考虑修改应用的架构，可以增加汇总表，或者增加外部缓存系统</p>
<h4 id="优化关联查询"><a href="#优化关联查询" class="headerlink" title="优化关联查询"></a>优化关联查询</h4><ul>
<li>确保on或者using字句中的列上有索引</li>
<li>确保任何的group by和order by中的表达式只设计到一个表中的列</li>
<li>当升级mysql时需要注意关联语法、运算符优先级其他可能会发生变化的地方</li>
</ul>
<h4 id="优化子查询"><a href="#优化子查询" class="headerlink" title="优化子查询"></a>优化子查询</h4><p>子查询尽可能使用关联查询代替</p>
<h4 id="优化group-by和distinct"><a href="#优化group-by和distinct" class="headerlink" title="优化group by和distinct"></a>优化group by和distinct</h4><p>使用索引优化是最有效的优化方法</p>
<p>在mysql中，当无法使用索引的时候，group by使用两种策略来完成：使用临时表或者文件排序来左分组</p>
<p>如果需要对关联查询左分组，并且是按照查找表中的某个列进行分组，那么通常采用查找表的标识列分组的效率会比其他列更好</p>
<h5 id="优化group-by-with-rollup"><a href="#优化group-by-with-rollup" class="headerlink" title="优化group  by with rollup"></a>优化group  by with rollup</h5><p>分组查询的一个变种就是要求mysql对返回的分组结果在做一次超级聚合，很多时候建议在应用中实现超级聚合</p>
<h4 id="优化limit分页"><a href="#优化limit分页" class="headerlink" title="优化limit分页"></a>优化limit分页</h4><p>优化分页查询的一个最简单的办法就是尽可能的使用索引覆盖扫描，而不是查询所有的列，然后根据需要左一次关联操作在返回所需的列，对于偏移量很大的时候，这样做的效率提升非常大</p>
<p>比如<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> file_id,description <span class="keyword">from</span> <span class="keyword">file</span> <span class="keyword">order</span> <span class="keyword">by</span> title <span class="keyword">limit</span> <span class="number">50</span>,<span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<p>最好改写成以下语句<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> file_id,description </span><br><span class="line"><span class="keyword">from</span> <span class="keyword">file</span> </span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> (</span><br><span class="line">    <span class="keyword">select</span> file_id </span><br><span class="line">    <span class="keyword">from</span> <span class="keyword">file</span></span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> title</span><br><span class="line">    <span class="keyword">limit</span> <span class="number">50</span>,<span class="number">5</span></span><br><span class="line">    )<span class="keyword">as</span> lim <span class="keyword">using</span>(file_id)</span><br></pre></td></tr></table></figure></p>
<p>这里的延迟关联将会大大提升查询效率，它让mysql扫描尽可能少的页面，获取需要访问的记录了后在根据关联列在回到原表查询需要的所有列</p>
<h4 id="优化sql-calc-found-rows"><a href="#优化sql-calc-found-rows" class="headerlink" title="优化sql_calc_found_rows"></a>优化sql_calc_found_rows</h4><p>分页的时候，另一个常用的技巧时在limit语句中加上sql_calc_found_rows提示(hint)，这样就可以获得去掉limit以后的满足条件的行数，因此可以作为分页的总数</p>
<h4 id="优化union查询"><a href="#优化union查询" class="headerlink" title="优化union查询"></a>优化union查询</h4><p>mysql总是通过创建并填充临时表的方式来执行union查询，因此很多优化策略在union查询中都无法使用。</p>
<p>除非确实需要服务器消除重复的行，否则就一定要使用union all，如果没有all关键字，mysql会给临时表加上distinct选项，这回导致对整个临时表的数据做唯一性检查</p>
<h4 id="使用用户自定义变量"><a href="#使用用户自定义变量" class="headerlink" title="使用用户自定义变量"></a>使用用户自定义变量</h4><p>在以下场景不能使用用户自定义变量</p>
<ul>
<li>使用自定义变量的查询，无法使用查询缓存</li>
<li>不能在使用常量或者标识符的地方使用自定义变量，</li>
<li>用户自定义变量的生命周期是在一个连接中游戏哦啊，所以不能用他们来左连接中的通信</li>
<li>如果使用连接池或者使用持久化连接，自定义变脸可能让看起来毫无关系的代码发生交互</li>
<li>不能显示的声明自定义变量的类型</li>
<li>mysql优化器在某些场景下可能会将这些变量优化掉</li>
<li>赋值的顺序和赋值的时间点不总是固定的</li>
<li>赋值符号:=的优先级非常低</li>
<li>使用未定义变量不会产生任何语法错误</li>
</ul>
<blockquote>
<p>注：</p>
<ul>
<li>上述测试在<strong>ubuntu16.04 lts</strong> <strong>jdk1.8</strong> <strong>spring boot 1.5.6.RELEASE</strong>中成功</li>
<li>上述文字皆为个人看法，如有错误或建议请及时联系我</li>
</ul>
</blockquote>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2018/04/04/高性能MySQL-study/">高性能MySQL学习笔记</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">EarthChen</a></p>
        <p><span>发布时间:</span>2018-04-04, 16:30:00</p>
        <p><span>最后更新:</span>2018-07-21, 16:24:50</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2018/04/04/高性能MySQL-study/" title="高性能MySQL学习笔记">http://earthchen.cn/2018/04/04/高性能MySQL-study/</a>
            <span class="copy-path" data-clipboard-text="原文: http://earthchen.cn/2018/04/04/高性能MySQL-study/　　作者: EarthChen" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2018/04/10/manjaro安装软件脚本/">
                    manjaro系统相关脚本和配置
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2018/04/01/httpclientutil/">
                    HttpClient工具类
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL架构"><span class="toc-number">1.</span> <span class="toc-text">MySQL架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#并发控制"><span class="toc-number">1.1.</span> <span class="toc-text">并发控制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#读写锁"><span class="toc-number">1.1.1.</span> <span class="toc-text">读写锁</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事物"><span class="toc-number">1.2.</span> <span class="toc-text">事物</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#隔离级别"><span class="toc-number">1.2.1.</span> <span class="toc-text">隔离级别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL的存储引擎"><span class="toc-number">1.3.</span> <span class="toc-text">MySQL的存储引擎</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Schema与数据类型优化"><span class="toc-number">2.</span> <span class="toc-text">Schema与数据类型优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#选择优化的数据类型"><span class="toc-number">2.1.</span> <span class="toc-text">选择优化的数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-schema设计中的陷阱"><span class="toc-number">2.2.</span> <span class="toc-text">MySQL schema设计中的陷阱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#范式和反范式"><span class="toc-number">2.3.</span> <span class="toc-text">范式和反范式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#范式的优缺点"><span class="toc-number">2.3.1.</span> <span class="toc-text">范式的优缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#反范式的优缺点"><span class="toc-number">2.3.2.</span> <span class="toc-text">反范式的优缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#混用范式和反范式"><span class="toc-number">2.3.3.</span> <span class="toc-text">混用范式和反范式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#缓存表和汇总表"><span class="toc-number">2.4.</span> <span class="toc-text">缓存表和汇总表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#物化视图"><span class="toc-number">2.4.1.</span> <span class="toc-text">物化视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#计数器表"><span class="toc-number">2.4.2.</span> <span class="toc-text">计数器表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加快ALTER-TABLE操作的数据"><span class="toc-number">2.5.</span> <span class="toc-text">加快ALTER TABLE操作的数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#只修改-frm文件"><span class="toc-number">2.5.1.</span> <span class="toc-text">只修改.frm文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#快速创建myisam索引"><span class="toc-number">2.5.2.</span> <span class="toc-text">快速创建myisam索引</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建高性能的索引"><span class="toc-number">3.</span> <span class="toc-text">创建高性能的索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#索引基础"><span class="toc-number">3.1.</span> <span class="toc-text">索引基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#索引基础-1"><span class="toc-number">3.1.1.</span> <span class="toc-text">索引基础</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#B-Tree索引"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">B-Tree索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#哈希索引"><span class="toc-number">3.1.1.2.</span> <span class="toc-text">哈希索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#空间数据索引"><span class="toc-number">3.1.1.3.</span> <span class="toc-text">空间数据索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#全文索引"><span class="toc-number">3.1.1.4.</span> <span class="toc-text">全文索引</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#索引的优点"><span class="toc-number">3.2.</span> <span class="toc-text">索引的优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#高性能的索引策略"><span class="toc-number">3.3.</span> <span class="toc-text">高性能的索引策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#独立的列"><span class="toc-number">3.3.1.</span> <span class="toc-text">独立的列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#前缀索引和索引选择性"><span class="toc-number">3.3.2.</span> <span class="toc-text">前缀索引和索引选择性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多列索引"><span class="toc-number">3.3.3.</span> <span class="toc-text">多列索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#选择合适的索引列顺序"><span class="toc-number">3.3.4.</span> <span class="toc-text">选择合适的索引列顺序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#聚簇索引"><span class="toc-number">3.3.5.</span> <span class="toc-text">聚簇索引</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#InnoDB-MyISAM的数据分布对比"><span class="toc-number">3.3.5.1.</span> <span class="toc-text">InnoDB MyISAM的数据分布对比</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#覆盖索引"><span class="toc-number">3.3.6.</span> <span class="toc-text">覆盖索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用索引扫描来做排序"><span class="toc-number">3.3.7.</span> <span class="toc-text">使用索引扫描来做排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#压缩-前缀压缩-索引"><span class="toc-number">3.3.8.</span> <span class="toc-text">压缩(前缀压缩)索引</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询性能优化"><span class="toc-number">4.</span> <span class="toc-text">查询性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#慢查询基础：优化数据访问"><span class="toc-number">4.1.</span> <span class="toc-text">慢查询基础：优化数据访问</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#是否向数据可请求了不需要的数据"><span class="toc-number">4.1.1.</span> <span class="toc-text">是否向数据可请求了不需要的数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQL是否扫描额外的记录"><span class="toc-number">4.1.2.</span> <span class="toc-text">MySQL是否扫描额外的记录</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#响应时间"><span class="toc-number">4.1.2.1.</span> <span class="toc-text">响应时间</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#扫描的行数和返回的行数"><span class="toc-number">4.1.2.2.</span> <span class="toc-text">扫描的行数和返回的行数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#扫描的行数和访问类型"><span class="toc-number">4.1.2.3.</span> <span class="toc-text">扫描的行数和访问类型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重构查询方式"><span class="toc-number">4.2.</span> <span class="toc-text">重构查询方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#一个复杂查询还是多个简单查询"><span class="toc-number">4.2.1.</span> <span class="toc-text">一个复杂查询还是多个简单查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#切分查询"><span class="toc-number">4.2.2.</span> <span class="toc-text">切分查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分解关联查询"><span class="toc-number">4.2.3.</span> <span class="toc-text">分解关联查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优化特定类型的查询"><span class="toc-number">4.3.</span> <span class="toc-text">优化特定类型的查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#优化count-查询"><span class="toc-number">4.3.1.</span> <span class="toc-text">优化count()查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#简单的优化"><span class="toc-number">4.3.1.1.</span> <span class="toc-text">简单的优化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#使用近似值"><span class="toc-number">4.3.1.2.</span> <span class="toc-text">使用近似值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#更复杂的优化"><span class="toc-number">4.3.1.3.</span> <span class="toc-text">更复杂的优化</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#优化关联查询"><span class="toc-number">4.3.2.</span> <span class="toc-text">优化关联查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#优化子查询"><span class="toc-number">4.3.3.</span> <span class="toc-text">优化子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#优化group-by和distinct"><span class="toc-number">4.3.4.</span> <span class="toc-text">优化group by和distinct</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#优化group-by-with-rollup"><span class="toc-number">4.3.4.1.</span> <span class="toc-text">优化group  by with rollup</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#优化limit分页"><span class="toc-number">4.3.5.</span> <span class="toc-text">优化limit分页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#优化sql-calc-found-rows"><span class="toc-number">4.3.6.</span> <span class="toc-text">优化sql_calc_found_rows</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#优化union查询"><span class="toc-number">4.3.7.</span> <span class="toc-text">优化union查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用用户自定义变量"><span class="toc-number">4.3.8.</span> <span class="toc-text">使用用户自定义变量</span></a></li></ol></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-5 i,
        .toc-level-5 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"高性能MySQL学习笔记　| EarthChen's Blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
        <section class="youyan" id="comments">
    <script>
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = 'http://v2.uyan.cc/code/uyan.js?uid=2115719';
            (d.head || d.body).appendChild(s);
        }
    </script>
    
    <script> loadComment(); </script>

    <div id="uyan_frame"></div>
</section>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2018/04/10/manjaro安装软件脚本/" title="上一篇: manjaro系统相关脚本和配置">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2018/04/01/httpclientutil/" title="下一篇: HttpClient工具类">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/08/26/使用aop进行多数据源切换/">spring-boot使用aop进行多数据源切换</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/25/使用aop记录日志/">spring-boot使用aop进行日志记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/09/spring-boot自定义starter/">spring-boot自定义starter</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/25/java面试要点汇总(分布式和微服务)/">java面试知识要点汇总(分布式和微服务)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/23/java面试要点汇总(框架)/">java面试知识要点汇总(框架)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/22/java面试要点汇总(缓存和消息队列)/">java面试知识要点汇总(缓存和消息队列)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/19/java面试要点汇总(web和数据库)/">java面试知识要点汇总(web和数据库)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/15/java面试要点汇总(线程和锁)/">java面试知识要点汇总(线程和锁)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/14/java面试要点汇总(基础和集合部分)/">java面试知识要点汇总(基础和集合)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/23/hbase-study/">hbase 学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/30/算法图解-study/">算法图解书中算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/27/newcoder-2017校招-1/">牛客网2017年校招真题-1</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/26/sql_inner_left_right_join/">sql中的inner join left join 和right join各种连接的区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/21/newcoder-剑指offer-3/">牛客网剑指offer-3</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/06/java8-features/">java8新特性总结备忘</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/05/java-generic/">java泛型总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/05/java-refect/">java反射总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/02/newcoder-剑指offer-2/">牛客网剑指offer-2</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/17/newcoder-剑指offer-1/">牛客网剑指offer-1</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/17/MongDB-study-4/">MongoDB权威指南学习笔记(4)--应用管理和服务器管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/15/MongDB-study-3/">MongoDB权威指南学习笔记(3)--复制和分片</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/13/MongDB-study-2/">MongoDB权威指南学习笔记(2)--设计应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/11/MongDB-study-1/">MongoDB权威指南学习笔记(1)--基础知识与对文档的增删改查</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/10/manjaro安装软件脚本/">manjaro系统相关脚本和配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/04/高性能MySQL-study/">高性能MySQL学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/01/httpclientutil/">HttpClient工具类</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/14/qiniu-oss/">spring boot使用七牛云的oss(对象存储)文件上传</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/13/requestHolder_and_argumentResolver/">使用ThreadLocal和ArgumentResolver方便开发</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/13/applicationContextHelper/">在不被spring容器管理的类中使用ApplicationContext应用上下文bean</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/springboot_static_class_autowrite/">Spring boot 在静态类中注入spring组件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/22/springboot_diy_properties/">Spring boot 自定义配置文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/12/Elasticsearch_study_1/">Elasticsearch学习笔记 -- 1</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/09/深入理解java虚拟机学习笔记_1/">深入理解java虚拟机学习笔记 -- 1</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/23/Docker_study_Dockerfile_instructions/">Docker学习笔记---Dockerfile</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/22/Docker_study/">Docker学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/20/celery_study/">Celery-分布式任务队列学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/18/django_redis_cache/">Django使用redis作为缓存系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/18/django_channels_websocket/">Django使用Channels实现websocket</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/13/Docker_Gogs/">使用Docker搭建git服务Gogs</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/06/LeetCode_Record_Easy_21to_40/">LeetCode刷题记录(easy难度21-40题)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/06/LeetCode_Record_Easy_1to20/">LeetCode刷题记录(easy难度1-20题)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/29/es6_study/">es6学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/27/Webpack_study/">Webpack学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/23/RegularExpression_study/">正则表达式学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/08/AndroidStudio/">Android Studio 使用本地离线Gradle</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/30/跨域请求解决方案/">跨域请求的解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/30/django_nginx_gunicorn/">django+nginx+gunicorn部署配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/30/ubuntu_supervisor/">ubuntu下的进程控制系统————Supervisor</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/28/ubuntu修复不能挂载NTFS硬盘/">ubuntu修复linux和windows双系统下挂载ntfs硬盘出错问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/17/django_timing_task/">django使用django-crontab实现定时任务</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/15/django_rest_framework_jwt/">django-rest-framework配置json web token进行接口的认证</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/12/spring_SpEL/">spring中的SpEL表达式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/12/django_rest_framework_study/">django-rest-framework框架学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/08/git_study/">Git学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/03/资源收集/">资源收集共享</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/06/ubuntu_open_port/">ubuntu开放指定端口</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/16/redis_study_2/">Redis学习笔记 -- 2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/15/redis_study_1/">Redis学习笔记 -- 1</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/16/ubuntu_do_something_use/">ubuntu日常使用的安装配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/15/django_address_baiduapi_marker_show/">Django调用百度地图api在地图上批量增加标记点</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/15/ubuntu_do_something_coding/">ubuntu搭建常见开发环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/10/ubuntu安装在双系统笔记本下开机或关机卡死.1/">ubuntu在双系统下开机卡死或关机卡死的解决办法</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/11/python_requirements/">python生成项目所需依赖文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/10/hexo_github_coding_blog/">利用hexo和github或coding 搭免费个人博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/15/django数据库操作/">Django操作数据库</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/15/django连接mysql数据库/">Django连接MySql使用models处理数据</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/15/django环境搭建/">Django环境搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/15/django渲染模板/">Django渲染模板</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/15/python2和Python3的区别/">Python2和Python3的区别简单总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/15/django常用语句/">Django常用语句</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/03/Android_qq_Menu/">Android仿qq侧滑菜单</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/16/C语言队列的基本操作/">C语言队列的基本操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/15/C语言中缀表达式计算器/">C语言中缀表达式计算器</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/15/c语言中缀表达式变后缀表达式/">C语言中缀表达式转后缀表达式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/15/C语言逆波兰计算器/">C语言逆波兰表达式计算(后缀表达式计算器)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/15/C语言二叉树基本操作/">C语言二叉树的基本操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/15/C语言共享栈/">C语言共享栈</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2018 EarthChen
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
             github: ".github-widget a", 
            
            
            
             categories: ".article-category a, a.tag-list-link", 
             articleNav: "#article-nav a, #post-nav-button a", 
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>